


<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Welcome to NNE &#8212; NNE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=36b58c3a" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script src="_static/documentation_options.js?v=8a448e45"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'index';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Welcome to NNE" href="home/home.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://nnehome.github.io">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">NNE</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="home/home.html">
                         Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="code/code.html">
                         Code
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="home/home.html">
                         Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="code/code.html">
                         Code
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<section id="welcome-to-nne">
<h1>Welcome to NNE<a class="headerlink" href="#welcome-to-nne" title="Link to this heading">#</a></h1>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This website describes the neural net estimator (NNE) to estimate structural models, as proposed
in <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3496098#" rel="noopener noreferrer" target="_blank">Wei and Jiang (2023)</a>. It provides a computationally-light alternative to simulated maximum likelihood
or simulated method of moments. NNE is especially suitable for cases where many simulations are needed to
evaluate likelihood/moment functions.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="overview-of-nne">
<h2>Overview of NNE<a class="headerlink" href="#overview-of-nne" title="Link to this heading">#</a></h2>
<p>We write down a structural model: <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">g(x,</span> <span class="pre">ϵ;</span> <span class="pre">θ)</span></code>. The goal of estimation is to obtain the parameter <span class="math notranslate nohighlight">\({θ}\)</span>
after observing the covariates <span class="math notranslate nohighlight">\({x}\)</span> and outcome <code class="docutils literal notranslate"><span class="pre">y:</span> <span class="pre">{y,x}</span> <span class="pre">→</span> <span class="pre">θ</span></code>.</p>
<p>The key idea of NNE is to use neural nets to directly learn the mapping from data to parameters.
The graph below provides an overview of NNE.</p>
<div class="math notranslate nohighlight" id="equation-neural-net-training">
<span class="eqno">(1)<a class="headerlink" href="#equation-neural-net-training" title="Link to this equation">#</a></span>\[\begin{split}\begin{align*}
\text{train a neural net } f(\cdot) \quad
\begin{cases}
\boldsymbol{\theta}^{(1)} \xrightarrow{\boldsymbol{g}(\boldsymbol{x}_{i},\boldsymbol{\varepsilon}_{i}^{(1)};\boldsymbol{\theta}^{(1)})} &amp; \{\boldsymbol{y}_{i}^{(1)},\boldsymbol{x}_{i}\}_{i=1}^{n} \xrightarrow{\text{moments}} \boldsymbol{m}^{(1)} \xrightarrow{\text{neural net}} \widehat{\boldsymbol{\theta}}^{(1)} \\
\boldsymbol{\theta}^{(2)} \xrightarrow{\hspace{6em}} &amp; \{\boldsymbol{y}_{i}^{(2)},\boldsymbol{x}_{i}\}_{i=1}^{n} \xrightarrow{\hspace{4em}} \boldsymbol{m}^{(2)} \xrightarrow{\hspace{4.3em}} \widehat{\boldsymbol{\theta}}^{(2)} \\
\vdots &amp; \vdots \\
\boldsymbol{\theta}^{(L)} \xrightarrow{\hspace{6em}} &amp; \{\boldsymbol{y}_{i}^{(L)},\boldsymbol{x}_{i}\}_{i=1}^{n} \xrightarrow{\hspace{4em}} \boldsymbol{m}^{(L)} \xrightarrow{\hspace{4em}} \widehat{\boldsymbol{\theta}}^{(L)}
\end{cases}
\end{align*}\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-neural-net-application">
<span class="eqno">(2)<a class="headerlink" href="#equation-neural-net-application" title="Link to this equation">#</a></span>\[\begin{align*}
\text{apply } f(\cdot) \text{on real data} \quad \quad
\begin{cases}
\{\underbrace{\boldsymbol{y}_{i},\boldsymbol{x}_{i}}_{\text{real data}}\}_{i=1}^{n} \xrightarrow{\text{moments}} \boldsymbol{m} \xrightarrow{\text{neural net}} \underbrace{\widehat{\boldsymbol{\theta}}}_{\text{estimate}}
\end{cases}
\end{align*}\]</div>
<dl class="simple">
<dt>Notation:</dt><dd><p><span class="math notranslate nohighlight">\(\boldsymbol{\theta}^{(\ell)}\)</span> drawn from a space <span class="math notranslate nohighlight">\(\Theta\)</span>;
<span class="math notranslate nohighlight">\(\boldsymbol{y}_{i}=\boldsymbol{g}(\boldsymbol{x}_{i},\boldsymbol{\varepsilon}_{i};\boldsymbol{\theta})\)</span> a structural model;
<span class="math notranslate nohighlight">\(\boldsymbol{y}^{(\ell)}\)</span> simulated outcome;
<span class="math notranslate nohighlight">\(\boldsymbol{m}^{(\ell)}\)</span> simulated moments;
<span class="math notranslate nohighlight">\(\widehat{\boldsymbol{\theta}}\)</span> neural net prediction</p>
</dd>
</dl>
<ol class="arabic simple">
<li><p>We draw parameter values <span class="math notranslate nohighlight">\(\theta^{(l)}\)</span> uniformly from a parameter space <span class="math notranslate nohighlight">\(\Theta\)</span>. Using the structural model, we can generate the outcome <span class="math notranslate nohighlight">\(y^{(l)}\)</span> under <span class="math notranslate nohighlight">\(\theta^{(l)}\)</span>. After repeating this procedure a number of times, we get the corresponding datasets that are generated under a range of parameter values. These datasets form the basis of the training examples where we can use to learn the mapping from data to the “correct” parameter values.</p></li>
<li><p>To make training easier, we can summarize the data <span class="math notranslate nohighlight">\(\{y^{(l)}, x\}\)</span>  into data moments <span class="math notranslate nohighlight">\(m^{(l)}\)</span>.</p></li>
<li><p>The neural net takes the data moments as input and predicts the parameter value underlying that dataset.</p></li>
<li><p>Once the neural net is trained, we plug in the real data moments to obtain NNE estimates <span class="math notranslate nohighlight">\(\hat{\theta}\)</span>.</p></li>
</ol>
<p>The neural net can output “standard errors” in addition to point estimates. We establish that this neural net estimator (NNE)
converges to limited-information Bayesian posterior when the number of training datasets L is sufficiently large.
Besides the benefit of light computational cost, NNE is also robust to redundant moments, which is beneficial for cases where
there lacks clear guidance on moment choices from a theoretical perspective.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="applying-nne">
<h2>Applying NNE<a class="headerlink" href="#applying-nne" title="Link to this heading">#</a></h2>
<p>While the method is broadly applicable to many types of structural models, we use the consumer sequential search model to illustrate
how to use NNE. The accompanying Matlab code can be found on the <a class="reference external" href="https://github.com/nnehome/nne-matlab" rel="noopener noreferrer" target="_blank">GitHub</a> page. These codes can be used to replicate the Monte Carlo results
from <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3496098#" rel="noopener noreferrer" target="_blank">Wei and Jiang (2023)</a>.</p>
<p>We describe the key functions to implement NNE.</p>
<section id="generate-training-datasets">
<h3>Generate training datasets<a class="headerlink" href="#generate-training-datasets" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">nne_gen.m</span></code>: This function implements steps (1) and (2) from above.</p>
<div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% set up</span>

<span class="nb">clear</span><span class="p">;</span>
<span class="n">seed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="nb">type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="c">% denotes the type of moments in the Moments() function</span>

<span class="nb">tic</span><span class="p">;</span>

<span class="nb">rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w"> </span><span class="c">% number of simulations</span>

<span class="n">set_up</span><span class="w"> </span><span class="s">%</span><span class="w"> </span><span class="s">generate</span><span class="w"> </span><span class="s">a</span><span class="w"> </span><span class="s">search</span><span class="w"> </span><span class="s">dataset,</span><span class="w"> </span><span class="s">save</span><span class="w"> </span><span class="s">in</span><span class="w"> </span><span class="s">data.mat</span>

<span class="nb">load</span><span class="p">(</span><span class="s">&#39;data.mat&#39;</span><span class="p">)</span>

<span class="c">% table with (normalized) search cost and reservation utility</span>
<span class="n">curve</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">importdata</span><span class="p">(</span><span class="s">&#39;tableData.csv&#39;</span><span class="p">);</span>

<span class="c">%% simulate</span>

<span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">L</span>

<span class="w">    </span><span class="n">theta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">unifrnd</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span><span class="w"> </span><span class="n">ub</span><span class="p">);</span>

<span class="w">    </span><span class="p">[</span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gen_seq_search</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">        </span><span class="nb">randn</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">randn</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nb">unique</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">)),</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">curve</span><span class="p">);</span>

<span class="w">    </span><span class="c">% keep non-outlier informative draws</span>
<span class="w">    </span><span class="p">[</span><span class="n">buy_rate</span><span class="p">,</span><span class="w"> </span><span class="n">search_rate</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Statistics</span><span class="p">(</span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">buy_rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">buy_rate</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">search_rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">search_rate</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span>

<span class="w">        </span><span class="nb">input</span><span class="p">{</span><span class="n">l</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Moments</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">,</span><span class="w"> </span><span class="nb">type</span><span class="p">);</span>
<span class="w">        </span><span class="n">label</span><span class="p">{</span><span class="n">l</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span>

<span class="w">    </span><span class="k">end</span>

<span class="k">end</span>

<span class="c">% remove empty cells (outliers)</span>
<span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">(</span><span class="o">~</span><span class="nb">cellfun</span><span class="p">(</span><span class="s">&#39;isempty&#39;</span><span class="p">,</span><span class="nb">input</span><span class="p">));</span>
<span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">label</span><span class="p">(</span><span class="o">~</span><span class="nb">cellfun</span><span class="p">(</span><span class="s">&#39;isempty&#39;</span><span class="p">,</span><span class="n">label</span><span class="p">));</span>

<span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="nb">input</span><span class="p">);</span>
<span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

<span class="c">%% save</span>

<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="n">input_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),:);</span>
<span class="n">label_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">label</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),:);</span>

<span class="n">input_test</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,:);</span>
<span class="n">label_test</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">label</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,:);</span>

<span class="c">%% generate simulated real data (for Monte Carlo)</span>

<span class="p">[</span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gen_seq_search</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">theta_true</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">randn</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">randn</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nb">unique</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">)),</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">curve</span><span class="p">);</span>

<span class="n">input_sim_real</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Moments</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">,</span><span class="w"> </span><span class="nb">type</span><span class="p">);</span>
<span class="n">label_sim_real</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">theta_true</span><span class="p">;</span>

<span class="c">%% save training set and seed</span>
<span class="nb">toc</span><span class="p">;</span>

<span class="n">time_gen</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">toc</span><span class="o">/</span><span class="mi">60</span><span class="p">;</span>

<span class="nb">save</span><span class="p">(</span><span class="s">&#39;training_set.mat&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;input_train&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label_train&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;input_test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label_test&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;input_sim_real&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label_sim_real&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;label_name&#39;</span><span class="p">,</span><span class="w"> </span>ß<span class="o">&#39;</span><span class="n">time_gen</span><span class="o">&#39;</span><span class="p">)</span>

<span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">rng</span><span class="p">;</span>
<span class="nb">save</span><span class="p">(</span><span class="s">&#39;RNGstate.mat&#39;</span><span class="p">,</span><span class="s">&#39;state&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Several key steps include:</p>
<ul class="simple">
<li><p>Draw <span class="math notranslate nohighlight">\(\theta^{(l)}\)</span> <code class="docutils literal notranslate"><span class="pre">theta</span> <span class="pre">=</span> <span class="pre">unifrnd(lb,</span> <span class="pre">ub)</span></code>.</p></li>
<li><p>Simulate outcome <span class="math notranslate nohighlight">\(y^{(l)}\)</span> with function <code class="docutils literal notranslate"><span class="pre">gen_seq_search()</span></code>, which takes parameter <span class="math notranslate nohighlight">\(\theta^{(l)}\)</span> and error draw <span class="math notranslate nohighlight">\(\epsilon^{(l)}\)</span>. This function is specific to sequential search and can be changed to other structural models.</p></li>
<li><p>Summarize the data <span class="math notranslate nohighlight">\(\{y^{(l)},x\}\)</span> into data moments <span class="math notranslate nohighlight">\(m^{(l)}\)</span> with function <code class="docutils literal notranslate"><span class="pre">Moments()</span></code>. It can be adapted to generate moments in other applications.</p></li>
<li><p>We use 90% as training data and the rest 10% as testing data. The inputs are the moments while the labels are the corresponding correct parameters.</p></li>
<li><p>For the Monte Carlo estimation, we also generate a simulated “real” data under assumed parameter <code class="docutils literal notranslate"><span class="pre">theta_true</span></code>. The simulated “real” data moments are calculated using function <code class="docutils literal notranslate"><span class="pre">Moments()</span></code>.</p></li>
</ul>
</section>
<section id="train-a-neural-network">
<h3>Train a neural network<a class="headerlink" href="#train-a-neural-network" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">nne_train.m</span></code>: This function implements steps (3) and (4) from above.</p>
<div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% settings</span>

<span class="nb">clear</span><span class="p">;</span>
<span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
<span class="n">num_nodes</span><span class="p">=</span><span class="mi">64</span><span class="p">;</span>
<span class="nb">tic</span><span class="p">;</span>

<span class="nb">load</span><span class="p">(</span><span class="s">&#39;RNGstate.mat&#39;</span><span class="p">)</span>
<span class="nb">rng</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="n">learn_standard_error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="n">batch_size</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span>

<span class="c">%% read data</span>

<span class="nb">load</span><span class="p">(</span><span class="s">&#39;training_set.mat&#39;</span><span class="p">)</span>

<span class="n">L_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">input_train</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">L_test</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">input_test</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="n">dim_in</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">input_train</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">K</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">label_train</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">learn_standard_error</span>
<span class="w">    </span><span class="n">dim_out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>

<span class="w">    </span><span class="n">label_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">label_train</span><span class="p">,</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">L_train</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">)];</span>
<span class="w">    </span><span class="n">label_test</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">label_test</span><span class="p">,</span><span class="w">  </span><span class="nb">zeros</span><span class="p">(</span><span class="n">L_test</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">)];</span>

<span class="k">else</span>
<span class="w">    </span><span class="n">dim_out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">K</span><span class="p">;</span>
<span class="k">end</span>


<span class="c">%% training</span>

<span class="n">opts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">trainingOptions</span><span class="p">(</span><span class="w"> </span><span class="s">&#39;adam&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;ExecutionEnvironment&#39;</span><span class="p">,</span><span class="s">&#39;cpu&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;LearnRateSchedule&#39;</span><span class="p">,</span><span class="s">&#39;piecewise&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;LearnRateDropFactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;LearnRateDropPeriod&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;InitialLearnRate&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;GradientThreshold&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;MaxEpochs&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;Shuffle&#39;</span><span class="p">,</span><span class="s">&#39;every-epoch&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;MiniBatchSize&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">batch_size</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;L2Regularization&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;Plots&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;Verbose&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;ValidationData&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">input_test</span><span class="p">,</span><span class="w"> </span><span class="n">label_test</span><span class="p">},</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;ValidationFrequency&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>


<span class="n">layers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="n">featureInputLayer</span><span class="p">(</span><span class="n">dim_in</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Normalization&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rescale-symmetric&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="n">fullyConnectedLayer</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
<span class="w">            </span><span class="n">reluLayer</span>
<span class="w">            </span><span class="n">fullyConnectedLayer</span><span class="p">(</span><span class="n">dim_out</span><span class="p">)</span>
<span class="w">            </span><span class="n">normalRegressionLayer</span><span class="p">(</span><span class="s">&#39;simple&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">learn_standard_error</span><span class="p">)</span>
<span class="w">         </span><span class="p">];</span>

<span class="p">[</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">trainNetwork</span><span class="p">(</span><span class="n">input_train</span><span class="p">,</span><span class="w"> </span><span class="n">label_train</span><span class="p">,</span><span class="w"> </span><span class="n">layers</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">);</span>

<span class="c">%% summary</span>

<span class="n">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">PredSummary</span><span class="p">(</span><span class="n">input_test</span><span class="p">,</span><span class="w"> </span><span class="n">label_test</span><span class="p">,</span><span class="w"> </span><span class="n">label_name</span><span class="p">,</span><span class="w"> </span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;figure&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;table&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="c">%% obtain NNE estimate</span>

<span class="n">temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">input_sim_real</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;acceleration&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="n">theta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">K</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="n">learn_standard_error</span>
<span class="w">    </span><span class="n">se</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">PositiveTransform</span><span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">K</span><span class="p">));</span>
<span class="k">end</span>

<span class="nb">toc</span><span class="p">;</span>
<span class="n">time_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">toc</span><span class="o">/</span><span class="mi">60</span><span class="p">;</span>

<span class="n">out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">FinalValidationLoss</span><span class="p">,</span><span class="w"> </span><span class="n">time_gen</span><span class="p">,</span><span class="w"> </span><span class="n">time_train</span><span class="p">];</span>

<span class="n">csvwrite</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;theta_L%d_nodes%d.csv&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">num_nodes</span><span class="p">),</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</pre></div>
</div>
<p>Several key steps include:</p>
<ul class="simple">
<li><p>We can ask NNE to output standard errors by setting <code class="docutils literal notranslate"><span class="pre">learn_standard_error</span> <span class="pre">=</span> <span class="pre">true;</span></code>. It will double the dimensionality of the NNE output by including both the point estimates and the standard errors.</p></li>
<li><p>Train the neural net with function: <code class="docutils literal notranslate"><span class="pre">[net,</span> <span class="pre">info]</span> <span class="pre">=</span> <span class="pre">trainNetwork(input_train,</span> <span class="pre">label_train,</span> <span class="pre">layers,</span> <span class="pre">opts);</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">layers</span></code> defines the network structure (e.g., number of layers and nodes)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opts</span></code> defines the training specification (e.g., number of epochs and batch size)</p></li>
<li><p>The loss function is defined in <code class="docutils literal notranslate"><span class="pre">normalRegressionLayer</span></code>, which depends on whether neural net needs to learn standard errors.</p></li>
</ul>
</li>
<li><p>For the Monte Carlo estimation, obtain estimates for the simulated “real” data with function: <code class="docutils literal notranslate"><span class="pre">predict(net,</span> <span class="pre">input_sim_real,</span> <span class="pre">'acceleration',</span> <span class="pre">'none');</span></code> where <code class="docutils literal notranslate"><span class="pre">net</span></code> denotes the trained neural network.</p></li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

<footer class="bd-footer">
  <div class="bd-footer__inner bd-page-width">
    <div class="footer-items__start">    
        <div class="footer-item">
          <p>© Copyright 2023, <a href="https://sites.google.com/site/yanhaomaxwei/" target="_blank">Yanhao "Max" Wei</a>, 
                                <a href="https://jiangzhenling.com/" target="_blank">Zhenling Jiang </a>.</p>
    </div>                      
  </div>
</footer>

  </body>
</html>