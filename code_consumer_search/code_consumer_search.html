


<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Consumer search &#8212; NNE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=95b8dc44" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script src="../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'code_consumer_search/code_consumer_search';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simple AR1 model" href="../code_ar1_model/code_ar1_model.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../home/home.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://nnehome.github.io">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">NNE</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../home/home.html">
                         Home
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                         Consumer Search
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../code_ar1_model/code_ar1_model.html">
                         AR1 Model
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../home/home.html">
                         Home
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                         Consumer Search
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../code_ar1_model/code_ar1_model.html">
                         AR1 Model
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Consumer search</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="consumer-search">
<span id="code-consumer-search"></span><h1>Consumer search<a class="headerlink" href="#consumer-search" title="Link to this heading">#</a></h1>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>One example application of NNE is to estimate consumer search model. This <a class="reference external" href="https://github.com/nnehome/nne-matlab" rel="noopener noreferrer" target="_blank">GitHub</a> repository provides the Matlab (2023b) code. Below we provide description of the code files. The code itself is commented as well. You are welcome to modify the code to estimate your own structural model.</p>
<p>More details of this application (e.g., specification of the search model) can be found in our paper referenced in <a class="reference internal" href="../home/home.html#home"><span class="std std-ref">home</span></a> page.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="an-example-to-use-the-code">
<h2>An example to use the code:<a class="headerlink" href="#an-example-to-use-the-code" title="Link to this heading">#</a></h2>
<p>Run the three scripts in order as follows. This example is a Monte Carlo experiment that uses NNE to estimate the search model parameter from a simulated dataset.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt; monte_carlo_data         % simulate a dataset and save it in data.mat</span>
<span class="go">&gt;&gt; nne_gen                  % generate the training examples for NNE and save them in nne_training.mat</span>
<span class="go">&gt;&gt; nne_train                % train a neural net and then apply it on data.mat</span>
</pre></div>
</div>
<p>Three functions are used in these scripts: <code class="docutils literal notranslate"><span class="pre">model_seq_search.m</span></code>, <code class="docutils literal notranslate"><span class="pre">moments.m</span></code>, and <code class="docutils literal notranslate"><span class="pre">normalRegressionLayer.m</span></code>, which are explained in the description below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="description-of-each-file">
<h2>Description of each file:<a class="headerlink" href="#description-of-each-file" title="Link to this heading">#</a></h2>
<section id="model-seq-search-m">
<h3><code class="docutils literal notranslate"><span class="pre">model_seq_search.m</span></code><a class="headerlink" href="#model-seq-search-m" title="Link to this heading">#</a></h3>
<p>This function codes a sequential search model.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[yd, yt, order] = model_seq_search(pos, z, consumer_id, theta, curve)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Inputs:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pos</span></code>: product ranking positions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z</span></code>: other product attributes (e.g., review rating, price)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consumer_id</span></code>: indices of consumers (or search sessions)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta</span></code>: vector of search model parameter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">curve</span></code>: relation between search cost and reservation utility, stored in <code class="docutils literal notranslate"><span class="pre">curve_seq_search.csv</span></code></p></li>
</ul>
</li>
<li><p>Outputs:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">yd</span></code>: dummies indicating if products are searched</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yt</span></code>: dummies indicating if products are bought</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">order</span></code>: order of search</p></li>
</ul>
</li>
</ul>
<details class="summary-show-code-collapse-header-model-seq-search-m-collapse-header">
<summary>Show code <collapse_header>model_seq_search.m</collapse_header></summary><div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[yd, yt, order] = model_seq_search</span><span class="p">(</span>pos, z, consumer_id, theta, curve<span class="p">)</span>

<span class="cm">%{</span>

<span class="cm">This function codes the sequential search model and is largely based on the</span>
<span class="cm">code used in Ursu (2018): &quot;The Power of Rankings ...&quot;</span>

<span class="cm">Outputs:</span>
<span class="cm">    yd .. search dummies</span>
<span class="cm">    yt .. purchase dummies</span>
<span class="cm">    order .. search order</span>
<span class="cm">Inputs:</span>
<span class="cm">    pos .. prodoct ranking positions</span>
<span class="cm">    z .. other product attributes</span>
<span class="cm">    consumer_id .. consumer indices</span>
<span class="cm">    theta .. model parameter</span>
<span class="cm">    curve .. relation between search cost and reservation utility</span>

<span class="cm">%}</span>

<span class="c">%% random terms</span>

<span class="n">rows</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">);</span><span class="w"> </span><span class="c">% number of observations</span>
<span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="nb">unique</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">));</span><span class="w"> </span><span class="c">% number of consumers</span>

<span class="nb">eps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">randn</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% utility shocks for inside goods</span>
<span class="n">eps0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c">% utility shocks for outside goods</span>

<span class="c">%% setup</span>

<span class="c">% number of options for each consumer</span>
<span class="n">Ji</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">accumarray</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">Ji</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Ji</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">);</span>

<span class="n">bepos</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">theta</span><span class="p">(</span><span class="k">end</span><span class="p">);</span><span class="w"> </span><span class="c">% last par, position</span>
<span class="n">constc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">theta</span><span class="p">(</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% par (2nd to last): constant in search cost</span>

<span class="n">v0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">theta</span><span class="p">(</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c">% outside option</span>

<span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ismember</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">);</span><span class="w"> </span><span class="c">% index of consumers in the data</span>

<span class="c">%form utility from data and param</span>
<span class="n">eutility</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">&#39;</span><span class="p">;</span>

<span class="n">utility</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">eutility</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">eps</span><span class="p">;</span>

<span class="c">% utility of the outside option</span>
<span class="n">u0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eps0</span><span class="p">;</span>

<span class="c">% search cost c, and therefore m, only changes with pos</span>

<span class="n">pos_unique</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sort</span><span class="p">(</span><span class="nb">unique</span><span class="p">(</span><span class="n">pos</span><span class="p">));</span>
<span class="n">m_pos</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">pos_unique</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">pos_unique</span><span class="p">)</span>
<span class="w">    </span><span class="n">c_i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="n">constc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">.*</span><span class="n">bepos</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">c_i</span><span class="o">&lt;</span><span class="n">curve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c_i</span><span class="o">&gt;=</span><span class="n">curve</span><span class="p">(</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c_i</span><span class="p">)</span>
<span class="w">                </span><span class="n">m_pos</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="p">((</span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">c_i</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">c_i</span><span class="o">&gt;</span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="w">                </span><span class="n">m_pos</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="w">            </span><span class="k">end</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">c_i</span><span class="o">&gt;=</span><span class="n">curve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="n">m_pos</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="n">c_i</span><span class="p">;</span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">c_i</span><span class="o">&lt;</span><span class="n">curve</span><span class="p">(</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="n">m_pos</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">4.001</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
<span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>

<span class="c">%reservation utilities</span>
<span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eutility</span><span class="p">;</span>

<span class="c">%order by r for each consumer</span>
<span class="n">da</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">Ji</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">utility</span><span class="p">,</span><span class="w"> </span><span class="n">eutility</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">];</span>
<span class="n">whatr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">da</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">whateu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">whatr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">whatu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">whateu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="n">order</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">index</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
<span class="w">    </span><span class="n">J</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Ji</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="c">%     for j = n:n+J-1</span>
<span class="w">    </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sort</span><span class="p">(</span><span class="n">da</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">whatr</span><span class="p">),</span><span class="s">&#39;descend&#39;</span><span class="p">);</span>
<span class="c">%     end</span>
<span class="k">end</span>

<span class="n">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">index</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
<span class="w">    </span><span class="n">J</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Ji</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="n">o</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">da</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span>

<span class="c">% click decisions</span>
<span class="n">yd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">ydn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="c">% order of clicks</span>
<span class="n">order</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="c">% free first click</span>
<span class="n">yd</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="c">%for next click decisions: if r is higher than outside</span>
<span class="c">%option and higher than all utilities so far, then increase click d by one</span>
<span class="c">% It is ok to do this because we ordered the r&#39;s first, so we know that rn&gt;rn+1</span>
<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<span class="w">    </span><span class="n">J</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Ji</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">ma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">):(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">whatu</span><span class="p">),</span><span class="w"> </span><span class="n">u0</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="nb">j</span><span class="p">,</span><span class="w"> </span><span class="n">whatr</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ma</span>
<span class="w">            </span><span class="n">yd</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">ydn</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">):(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">yd</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">):(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)));</span>
<span class="k">end</span>

<span class="c">%tran decisions: if out of those clicked (the set of indices from first to</span>
<span class="c">%max) u=max, then put a 1, otherwise put zero; finally reshape</span>
<span class="n">yt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">mi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<span class="w">    </span><span class="n">J</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Ji</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="w">    </span><span class="n">ydn_i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ydn</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="c">%     if ydn_i&gt;0</span>
<span class="w">        </span><span class="n">order</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">):</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="n">ydn_i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">ydn_i</span><span class="p">;</span>
<span class="c">%     end</span>
<span class="w">    </span><span class="n">mi</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">):</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">([</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">):</span><span class="n">index</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">+</span><span class="n">ydn_i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">whatu</span><span class="p">);</span><span class="w"> </span><span class="n">u0</span><span class="p">(</span><span class="nb">i</span><span class="p">)]);</span>
<span class="k">end</span>
<span class="n">yt</span><span class="p">(</span><span class="n">data</span><span class="p">(:,</span><span class="w"> </span><span class="n">whatu</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mi</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="nb">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ismember</span><span class="p">((</span><span class="mi">1</span><span class="p">:</span><span class="n">rows</span><span class="p">)</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">);</span>
<span class="n">yd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">yd</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
<span class="n">yt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">yt</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
<span class="n">order</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>

<span class="k">end</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="moments-m">
<h3><code class="docutils literal notranslate"><span class="pre">moments.m</span></code><a class="headerlink" href="#moments-m" title="Link to this heading">#</a></h3>
<p>This function summarizes data into a set of moments (used in Step 2 in the procedure on <a class="reference internal" href="../home/home.html#home"><span class="std std-ref">home</span></a> page).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">output = moments(pos, z, consumer_id, yd, yt)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Inputs: as described above for <code class="docutils literal notranslate"><span class="pre">model_seq_search.m</span></code>.</p></li>
<li><p>Output: a vector collecting the values of the moments.</p></li>
</ul>
<details class="summary-show-code-collapse-header-moments-m-collapse-header">
<summary>Show code <collapse_header>moments.m</collapse_header></summary><div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>output<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">moments</span><span class="p">(</span>pos, z, consumer_id, yd, yt<span class="p">)</span>

<span class="cm">%{</span>

<span class="cm">This function specifies the data moments to be used in NNE.</span>

<span class="cm">Output:</span>
<span class="cm">    A vector collecting the data moments.</span>
<span class="cm">Inputs:</span>
<span class="cm">    pos .. product ranking positions</span>
<span class="cm">    z .. other product attributes</span>
<span class="cm">    consumer_id .. consumer indices</span>
<span class="cm">    yd .. search dummies</span>
<span class="cm">    yt .. purchase dummies</span>

<span class="cm">%}</span>

<span class="n">rows</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">];</span><span class="w"> </span><span class="c">% all outcome variables</span>
<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">pos</span><span class="p">)];</span><span class="w"> </span><span class="c">% all covariates</span>

<span class="n">ydn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">accumarray</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">yd</span><span class="p">);</span><span class="w"> </span><span class="c">% consumer-level number of searches</span>
<span class="n">ytn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">accumarray</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">);</span><span class="w"> </span><span class="c">% consumer-level purchase</span>

<span class="n">y_tilde</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">ydn</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ydn</span><span class="p">,</span><span class="w"> </span><span class="n">ytn</span><span class="p">];</span><span class="w"> </span><span class="c">% consumer-level outcomes</span>

<span class="c">% consumer-level average of x</span>
<span class="c">% x_bar = splitapply(@mean, x, consumer_id);</span>
<span class="n">x_sum</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="nb">i</span><span class="p">)</span><span class="nb">accumarray</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">(:,</span><span class="nb">i</span><span class="p">)),</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;uni&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="n">x_bar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">x_sum</span><span class="p">)</span><span class="o">./</span><span class="nb">accumarray</span><span class="p">(</span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="c">% mean vector of y</span>
<span class="n">m1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

<span class="c">% cross-covariances between y and x</span>
<span class="n">m2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">&#39;*</span><span class="n">x</span><span class="o">/</span><span class="n">rows</span><span class="p">;</span>
<span class="n">m2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m2</span><span class="p">(:)</span><span class="o">&#39;</span><span class="p">;</span>

<span class="c">% mean vector of y_tilde</span>
<span class="n">m3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">y_tilde</span><span class="p">);</span>

<span class="c">% cross-covariances between y_tilde and x_bar</span>
<span class="n">m4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">y_tilde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">y_tilde</span><span class="p">))</span><span class="o">&#39;*</span><span class="n">x_bar</span><span class="o">/</span><span class="n">rows</span><span class="p">;</span>
<span class="n">m4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m4</span><span class="p">(:)</span><span class="o">&#39;</span><span class="p">;</span>

<span class="c">% covariance matrix of y_tilde</span>
<span class="n">m5</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cov</span><span class="p">(</span><span class="n">y_tilde</span><span class="p">);</span>
<span class="n">m5</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m5</span><span class="p">(</span><span class="nb">tril</span><span class="p">(</span><span class="nb">true</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">m5</span><span class="p">))))</span><span class="o">&#39;</span><span class="p">;</span>

<span class="c">% collect all moments</span>
<span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">,</span><span class="w"> </span><span class="n">m4</span><span class="p">,</span><span class="w"> </span><span class="n">m5</span><span class="p">];</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="normalregressionlayer-m">
<h3><code class="docutils literal notranslate"><span class="pre">normalRegressionLayer.m</span></code><a class="headerlink" href="#normalregressionlayer-m" title="Link to this heading">#</a></h3>
<p>This file codes the cross-entropy loss. It extends the Matlab ‘s built-in MSE loss. This loss function is needed if we want NNE to output estimates of statistical accuracy in addition to point estimates.</p>
<details class="summary-show-code-collapse-header-normalregressionlayer-m-collapse-header">
<summary>Show code <collapse_header>normalRegressionLayer.m</collapse_header></summary><div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">normalRegressionLayer</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nnet</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">RegressionLayer</span>

<span class="cm">%{</span>

<span class="cm">This file codes the loss function for neural net training. It extends the</span>
<span class="cm">Matlab built-in regressionLayer. The regressionLayer uses the MSE loss.</span>
<span class="cm">This file adds a normal cross-entropy loss.</span>

<span class="cm">Set property learn_sd to true to use the cross-entropy loss. In this case,</span>
<span class="cm">the number of neural net outputs doubles to give both the mean and standard</span>
<span class="cm">deviation terms.</span>

<span class="cm">%}</span>

<span class="w">    </span><span class="k">properties</span>

<span class="w">        </span><span class="n">learn_sd</span>

<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="k">methods</span>

<span class="w">        </span><span class="k">function</span><span class="w"> </span>layer<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">normalRegressionLayer</span><span class="p">(</span>varargin<span class="p">)</span>

<span class="w">            </span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">inputParser</span><span class="p">;</span>
<span class="w">            </span><span class="n">addOptional</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;learn_sd&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="p">@</span><span class="nb">islogical</span><span class="p">)</span>
<span class="w">            </span><span class="n">parse</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="nb">varargin</span><span class="p">{:})</span>

<span class="w">            </span><span class="n">layer</span><span class="p">.</span><span class="n">learn_sd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Results</span><span class="p">.</span><span class="n">learn_sd</span><span class="p">;</span>

<span class="w">        </span><span class="k">end</span>

<span class="w">        </span><span class="k">function</span><span class="w"> </span>loss<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">forwardLoss</span><span class="p">(</span>layer, Y, T<span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">learn_sd</span>

<span class="w">                </span><span class="n">Q</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>

<span class="w">            </span><span class="k">else</span>

<span class="w">                </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

<span class="w">                </span><span class="n">S</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="n">Y</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="p">:));</span>
<span class="w">                </span><span class="n">V</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span>
<span class="w">                </span><span class="n">U</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span>

<span class="w">                </span><span class="n">Q</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">V</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="o">./</span><span class="n">S</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>

<span class="w">            </span><span class="k">end</span>

<span class="w">            </span><span class="n">loss</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">(:))</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="w">        </span><span class="k">end</span>

<span class="w">        </span><span class="k">function</span><span class="w"> </span>dLdY<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">backwardLoss</span><span class="p">(</span>layer, Y, T<span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">learn_sd</span>

<span class="w">                </span><span class="n">dLdY</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="w">            </span><span class="k">else</span>

<span class="w">                </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

<span class="w">                </span><span class="n">S</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="n">Y</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="p">:));</span>
<span class="w">                </span><span class="n">dS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<span class="w">                </span><span class="n">V</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span>
<span class="w">                </span><span class="n">U</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span>

<span class="w">                </span><span class="n">dLdS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">./</span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="o">./</span><span class="n">S</span><span class="o">.^</span><span class="mi">3</span><span class="o">.*</span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>
<span class="w">                </span><span class="n">dLdV</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="o">./</span><span class="n">S</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>

<span class="w">                </span><span class="n">dLdY</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">dLdV</span><span class="p">;</span><span class="w"> </span><span class="n">dLdS</span><span class="o">.*</span><span class="n">dS</span><span class="p">]</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="w">            </span><span class="k">end</span>
<span class="w">        </span><span class="k">end</span>

<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="monte-carlo-data-m">
<h3><code class="docutils literal notranslate"><span class="pre">monte_carlo_data.m</span></code><a class="headerlink" href="#monte-carlo-data-m" title="Link to this heading">#</a></h3>
<p>This script generates a dataset of consumer search under a “true” value of the search model parameter, for the purpose of Monte Carlo experiments. It uses the function <code class="docutils literal notranslate"><span class="pre">model_seq_search.m</span></code> to simulate the search and purchase choices. The data is saved in a file <code class="docutils literal notranslate"><span class="pre">data.mat</span></code>.</p>
<details class="summary-show-code-collapse-header-monte-carlo-data-m-collapse-header">
<summary>Show code <collapse_header>monte_carlo_data.m</collapse_header></summary><div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="cm">%{</span>

<span class="cm">This script generates a Monte Carlo data for estimation of the sequential</span>
<span class="cm">search model. The data will be saved in data.mat.</span>

<span class="cm">%}</span>

<span class="nb">clear</span>

<span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="c">% number of consumers (or search sessions)</span>
<span class="n">J</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w"> </span><span class="c">% number of options per consumer</span>

<span class="c">% 1st column are parameter names</span>
<span class="c">% 2nd column are true parameter value (for Monte Carlo studies).</span>

<span class="n">set_theta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&#39;\beta_1&#39;</span><span class="w">    </span><span class="mf">0.1</span><span class="w">     </span><span class="c">% coefficient (stars)</span>
<span class="w">            </span><span class="s">&#39;\beta_2&#39;</span><span class="w">    </span><span class="mf">0.0</span><span class="w">     </span><span class="c">% coefficient (review score)</span>
<span class="w">            </span><span class="s">&#39;\beta_3&#39;</span><span class="w">    </span><span class="mf">0.2</span><span class="w">     </span><span class="c">% coefficient (loc score)</span>
<span class="w">            </span><span class="s">&#39;\beta_4&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.2</span><span class="w">     </span><span class="c">% coefficient (chain)</span>
<span class="w">            </span><span class="s">&#39;\beta_5&#39;</span><span class="w">    </span><span class="mf">0.2</span><span class="w">     </span><span class="c">% coefficient (promotion)</span>
<span class="w">            </span><span class="s">&#39;\beta_6&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.2</span><span class="w">     </span><span class="c">% coefficient (price)</span>
<span class="w">            </span><span class="s">&#39;\eta&#39;</span><span class="w">       </span><span class="mf">3.0</span><span class="w">     </span><span class="c">% outside good</span>
<span class="w">            </span><span class="s">&#39;\delta_0&#39;</span><span class="w">  </span><span class="o">-</span><span class="mf">4.0</span><span class="w">     </span><span class="c">% search cost base</span>
<span class="w">            </span><span class="s">&#39;\delta_1&#39;</span><span class="w">   </span><span class="mf">0.1</span><span class="w">     </span><span class="c">% search cost position</span>
<span class="w">            </span><span class="p">};</span>

<span class="n">theta_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">set_theta</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">theta_true</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">set_theta</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="o">&#39;</span><span class="p">);</span>

<span class="n">rows</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">N</span><span class="o">*</span><span class="n">J</span><span class="p">;</span>

<span class="c">% draw the hotel attributes</span>
<span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">nan</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>

<span class="n">z</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">randsample</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.25</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">])</span><span class="o">&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% star rating</span>
<span class="n">z</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">randsample</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.08</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">])</span><span class="o">&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% review score</span>
<span class="n">z</span><span class="p">(:,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">normrnd</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="p">,</span><span class="n">rows</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% location score</span>
<span class="n">z</span><span class="p">(:,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">randsample</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">])</span><span class="o">&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% chain hotel dummy</span>
<span class="n">z</span><span class="p">(:,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">randsample</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">])</span><span class="o">&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% promotion dummy</span>
<span class="n">z</span><span class="p">(:,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">normrnd</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% log price</span>

<span class="c">% ranking positions</span>
<span class="n">pos</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repmat</span><span class="p">((</span><span class="mi">1</span><span class="p">:</span><span class="n">J</span><span class="p">)</span><span class="o">&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="c">% consumer index</span>
<span class="n">consumer_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repelem</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>

<span class="c">% search and purchase</span>
<span class="n">curve</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">importdata</span><span class="p">(</span><span class="s">&#39;curve_seq_search.csv&#39;</span><span class="p">);</span>
<span class="p">[</span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model_seq_search</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">theta_true</span><span class="p">,</span><span class="w"> </span><span class="n">curve</span><span class="p">);</span>

<span class="c">% save data</span>
<span class="nb">save</span><span class="p">(</span><span class="s">&#39;data.mat&#39;</span><span class="p">,</span><span class="s">&#39;theta_name&#39;</span><span class="p">,</span><span class="s">&#39;consumer_id&#39;</span><span class="p">,</span><span class="s">&#39;pos&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;yd&#39;</span><span class="p">,</span><span class="s">&#39;yt&#39;</span><span class="p">,</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;J&#39;</span><span class="p">)</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="nne-gen-m">
<h3><code class="docutils literal notranslate"><span class="pre">nne_gen.m</span></code><a class="headerlink" href="#nne-gen-m" title="Link to this heading">#</a></h3>
<p>This script generates the training and validation examples (Steps 1 &amp; 2 in the procedure on <a class="reference internal" href="../home/home.html#home"><span class="std std-ref">home</span></a> page).</p>
<ul class="simple">
<li><p>It loads the product attributes (<code class="docutils literal notranslate"><span class="pre">z</span></code> and <code class="docutils literal notranslate"><span class="pre">pos</span></code>)  in <code class="docutils literal notranslate"><span class="pre">data.mat</span></code>.</p></li>
<li><p>It uses <code class="docutils literal notranslate"><span class="pre">model_seq_search.m</span></code> to simulate the consumer choices in each training or validation example.</p></li>
<li><p>It uses <code class="docutils literal notranslate"><span class="pre">moments.m</span></code> to summarize data in each training or validation example.</p></li>
<li><p>Corner examples (e.g., nobody made a purchase) are dropped.</p></li>
<li><p>At the end, the training and validation examples are saved in a file <code class="docutils literal notranslate"><span class="pre">nne_training.mat</span></code>.</p></li>
</ul>
<details class="summary-show-code-collapse-header-nne-gen-m-collapse-header">
<summary>Show code <collapse_header>nne_gen.m</collapse_header></summary><div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="cm">%{</span>

<span class="cm">This script generates the training and validation examples to be used to</span>
<span class="cm">train NNE. The examples will be saved in nne_trainning.mat.</span>

<span class="cm">Change &#39;for&#39; to &#39;parfor&#39; if parallel computing toolbox is available.</span>

<span class="cm">%}</span>

<span class="nb">clear</span>

<span class="c">%% settings</span>

<span class="c">% 1st column are parameter names.</span>
<span class="c">% 2nd and 3rd columns are lower and upper bounds of parameter space Theta.</span>

<span class="n">Theta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&#39;\beta_1&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w">   </span><span class="mf">0.5</span><span class="w">     </span><span class="c">% coefficient (stars)</span>
<span class="w">        </span><span class="s">&#39;\beta_2&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w">   </span><span class="mf">0.5</span><span class="w">     </span><span class="c">% coefficient (review score)</span>
<span class="w">        </span><span class="s">&#39;\beta_3&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w">   </span><span class="mf">0.5</span><span class="w">     </span><span class="c">% coefficient (loc score)</span>
<span class="w">        </span><span class="s">&#39;\beta_4&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w">   </span><span class="mf">0.5</span><span class="w">     </span><span class="c">% coefficient (chain)</span>
<span class="w">        </span><span class="s">&#39;\beta_5&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w">   </span><span class="mf">0.5</span><span class="w">     </span><span class="c">% coefficient (promotion)</span>
<span class="w">        </span><span class="s">&#39;\beta_6&#39;</span><span class="w">   </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w">   </span><span class="mf">0.5</span><span class="w">     </span><span class="c">% coefficient (price)</span>
<span class="w">        </span><span class="s">&#39;\eta&#39;</span><span class="w">       </span><span class="mf">2.0</span><span class="p">,</span><span class="w">   </span><span class="mf">5.0</span><span class="w">     </span><span class="c">% outside good</span>
<span class="w">        </span><span class="s">&#39;\delta_0&#39;</span><span class="w">  </span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span><span class="w">  </span><span class="o">-</span><span class="mf">2.0</span><span class="w">     </span><span class="c">% search cost base</span>
<span class="w">        </span><span class="s">&#39;\delta_1&#39;</span><span class="w">  </span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="w">  </span><span class="mf">0.25</span><span class="w">    </span><span class="c">% search cost position</span>
<span class="w">        </span><span class="p">};</span>

<span class="n">label_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Theta</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">lb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">Theta</span><span class="p">(:,</span><span class="mi">2</span><span class="p">))</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">ub</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">Theta</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span><span class="o">&#39;</span><span class="p">;</span>

<span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e4</span><span class="p">;</span><span class="w"> </span><span class="c">% number of training &amp; validation examples</span>

<span class="c">% load reservation utility curve (to be used in search model)</span>
<span class="n">curve</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">importdata</span><span class="p">(</span><span class="s">&#39;curve_seq_search.csv&#39;</span><span class="p">);</span>

<span class="c">% load observed attributes in data</span>
<span class="nb">load</span><span class="p">(</span><span class="s">&#39;data.mat&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;pos&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;consumer_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;J&#39;</span><span class="p">)</span>

<span class="c">%% generate training &amp; validation examples</span>

<span class="c">% pre-allocation for training &amp; validation examples</span>
<span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">L</span>

<span class="w">    </span><span class="c">% draw the value for the search model parameter</span>
<span class="w">    </span><span class="n">theta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">unifrnd</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span><span class="w"> </span><span class="n">ub</span><span class="p">);</span>

<span class="w">    </span><span class="c">% simulate search and purchase outcomes</span>
<span class="w">    </span><span class="p">[</span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model_seq_search</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">curve</span><span class="p">);</span>

<span class="w">    </span><span class="c">% drop corner cases</span>

<span class="w">    </span><span class="n">buy_rate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="c">% fraction of consumers who purchased</span>
<span class="w">    </span><span class="n">num_srh</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">yd</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="c">% number of searches per consumer</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">buy_rate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">buy_rate</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">num_srh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">num_srh</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">J</span>

<span class="w">        </span><span class="nb">input</span><span class="p">{</span><span class="n">l</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">moments</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">);</span>
<span class="w">        </span><span class="n">label</span><span class="p">{</span><span class="n">l</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span>

<span class="w">    </span><span class="k">end</span>

<span class="k">end</span>

<span class="c">% convert cells to matrices</span>
<span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="nb">input</span><span class="p">);</span>
<span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

<span class="c">%% training-validation split</span>

<span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% number of examples excluding corner cases</span>
<span class="n">L_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="mf">0.9</span><span class="p">);</span><span class="w"> </span><span class="c">% number of training examples (90-10 split)</span>

<span class="n">input_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">L_train</span><span class="p">,:);</span>
<span class="n">label_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">label</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">L_train</span><span class="p">,:);</span>

<span class="n">input_val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">(</span><span class="n">L_train</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">L</span><span class="p">,:);</span>
<span class="n">label_val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">label</span><span class="p">(</span><span class="n">L_train</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">L</span><span class="p">,:);</span>

<span class="c">%% save</span>

<span class="nb">save</span><span class="p">(</span><span class="s">&#39;nne_training.mat&#39;</span><span class="p">,</span><span class="s">&#39;input_train&#39;</span><span class="p">,</span><span class="s">&#39;label_train&#39;</span><span class="p">,</span><span class="s">&#39;input_val&#39;</span><span class="p">,</span><span class="s">&#39;label_val&#39;</span><span class="p">,</span><span class="s">&#39;label_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="nne-train-m">
<h3><code class="docutils literal notranslate"><span class="pre">nne_train.m</span></code><a class="headerlink" href="#nne-train-m" title="Link to this heading">#</a></h3>
<p>This script trains a shallow neural net (Steps 3 &amp; 4 in the procedure on <a class="reference internal" href="../home/home.html#home"><span class="std std-ref">home</span></a> page).</p>
<ul class="simple">
<li><p>It loads the training and validation examples from <code class="docutils literal notranslate"><span class="pre">nne_training.mat</span></code> (created by <code class="docutils literal notranslate"><span class="pre">nne_gen.m</span></code>).</p></li>
<li><p>It uses <code class="docutils literal notranslate"><span class="pre">normalRegressionLayer.m</span></code> for the cross-entropy loss.</p></li>
<li><p>Validation loss is reported. You can use it to choose hyperparameters, such as the number of hidden nodes.</p></li>
<li><p>At the end, it applies the trained neural net to the data in <code class="docutils literal notranslate"><span class="pre">data.mat</span></code> and reports the estimate.</p></li>
</ul>
<details class="summary-show-code-collapse-header-nne-train-m-collapse-header">
<summary>Show code <collapse_header>nne_train.m</collapse_header></summary><div class="scrollable-code-block highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="cm">%{</span>

<span class="cm">This script trains the neural net in NNE, and then applies the trained</span>
<span class="cm">neural net on data.mat to obtain a parameter estimate.</span>

<span class="cm">%}</span>

<span class="nb">clear</span>

<span class="c">%% settings</span>

<span class="n">num_nodes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span><span class="w"> </span><span class="c">% number of hidden nodes (in shallow neural net)</span>
<span class="n">learn_sd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c">% whether to learn estimates of statistical accuracy</span>

<span class="c">%% load training &amp; validation examples</span>

<span class="nb">load</span><span class="p">(</span><span class="s">&#39;nne_training.mat&#39;</span><span class="p">)</span>

<span class="n">L_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">input_train</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% number of training examples</span>
<span class="n">L_val</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">input_val</span><span class="p">,</span><span class="w">   </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">% number of validation examples</span>

<span class="n">dim_input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">input_train</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c">% number of inputs by neural net</span>
<span class="n">dim_label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">label_train</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c">% number of parameters</span>

<span class="c">% extend neural net outputs in the case of learn_sd = true</span>
<span class="n">output_train</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">label_train</span><span class="p">,</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">L_train</span><span class="p">,</span><span class="w"> </span><span class="n">dim_label</span><span class="o">*</span><span class="n">learn_sd</span><span class="p">)];</span>
<span class="n">output_val</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">label_val</span><span class="p">,</span><span class="w">   </span><span class="nb">zeros</span><span class="p">(</span><span class="n">L_val</span><span class="p">,</span><span class="w">   </span><span class="n">dim_label</span><span class="o">*</span><span class="n">learn_sd</span><span class="p">)];</span>

<span class="n">dim_output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">output_train</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c">% number of outputs by neural net</span>

<span class="c">%% train a neural net</span>

<span class="n">opts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">trainingOptions</span><span class="p">(</span><span class="w"> </span><span class="s">&#39;adam&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;ExecutionEnvironment&#39;</span><span class="p">,</span><span class="s">&#39;cpu&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;LearnRateSchedule&#39;</span><span class="p">,</span><span class="s">&#39;piecewise&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;LearnRateDropPeriod&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;InitialLearnRate&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;GradientThreshold&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;MaxEpochs&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;Shuffle&#39;</span><span class="p">,</span><span class="s">&#39;every-epoch&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;MiniBatchSize&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;L2Regularization&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;Plots&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;Verbose&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;VerboseFrequency&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;ValidationData&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">input_val</span><span class="p">,</span><span class="w"> </span><span class="n">output_val</span><span class="p">},</span><span class="w"> </span><span class="k">...</span>
<span class="w">                        </span><span class="s">&#39;ValidationFrequency&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span>

<span class="n">layers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="w">  </span><span class="n">featureInputLayer</span><span class="p">(</span><span class="n">dim_input</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;normalization&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rescale-symmetric&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="n">fullyConnectedLayer</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
<span class="w">            </span><span class="n">reluLayer</span>
<span class="w">            </span><span class="n">fullyConnectedLayer</span><span class="p">(</span><span class="n">dim_output</span><span class="p">)</span>
<span class="w">            </span><span class="n">normalRegressionLayer</span><span class="p">(</span><span class="s">&#39;learn_sd&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">learn_sd</span><span class="p">)</span>
<span class="w">            </span><span class="p">];</span>

<span class="p">[</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">trainNetwork</span><span class="p">(</span><span class="n">input_train</span><span class="p">,</span><span class="w"> </span><span class="n">output_train</span><span class="p">,</span><span class="w"> </span><span class="n">layers</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">);</span>

<span class="nb">disp</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&quot;Final validation loss is: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">FinalValidationLoss</span><span class="p">)</span>

<span class="c">%% display figure: estimate vs. truth in validation</span>

<span class="n">pred_val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">input_val</span><span class="p">,</span><span class="w"> </span><span class="n">exec</span><span class="p">=</span><span class="s">&#39;cpu&#39;</span><span class="p">);</span>

<span class="n">figure</span>
<span class="s">sgtitle(&#39;Estimate vs. Truth in Validation&#39;)</span>

<span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">round</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">dim_label</span><span class="p">));</span>

<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">dim_label</span>
<span class="w">    </span><span class="nb">subplot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">i</span><span class="p">)</span>
<span class="w">    </span><span class="nb">scatter</span><span class="p">(</span><span class="n">label_val</span><span class="p">(:,</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="n">pred_val</span><span class="p">(:,</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;.&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">xlabel</span><span class="p">(</span><span class="n">label_name</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span>
<span class="w">    </span><span class="nb">axis</span><span class="w"> </span><span class="n">equal</span>
<span class="k">end</span>

<span class="c">%% apply the trained neural net to data.mat</span>

<span class="nb">load</span><span class="p">(</span><span class="s">&#39;data.mat&#39;</span><span class="p">);</span><span class="w"> </span><span class="c">% load data for estimation</span>

<span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">moments</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_id</span><span class="p">,</span><span class="w"> </span><span class="n">yd</span><span class="p">,</span><span class="w"> </span><span class="n">yt</span><span class="p">);</span><span class="w"> </span><span class="c">% calculate data moments to be used as neural net input</span>
<span class="n">pred</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">,</span><span class="w"> </span><span class="n">exec</span><span class="p">=</span><span class="s">&#39;cpu&#39;</span><span class="p">);</span><span class="w"> </span><span class="c">% apply the trained neural net</span>

<span class="n">estimate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pred</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dim_label</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% get point estimate</span>
<span class="n">sd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="n">pred</span><span class="p">(</span><span class="n">dim_label</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">))</span><span class="o">&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% get estimate of statistical accuracy</span>
<span class="n">sd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">sd</span><span class="p">;</span><span class="w"> </span><span class="n">nan</span><span class="p">(</span><span class="n">dim_label</span><span class="o">*~</span><span class="n">learn_sd</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span><span class="w"> </span><span class="c">% fill sd with nan if learn_sd=0</span>

<span class="c">% display estimates</span>
<span class="n">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="n">estimate</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;row&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">label_name</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;var&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Estimate&#39;</span><span class="p">,</span><span class="s">&#39;SD&#39;</span><span class="p">});</span>
<span class="n">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">rmmissing</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-to-use-the-code">An example to use the code:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#description-of-each-file">Description of each file:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-seq-search-m"><code class="docutils literal notranslate"><span class="pre">model_seq_search.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moments-m"><code class="docutils literal notranslate"><span class="pre">moments.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normalregressionlayer-m"><code class="docutils literal notranslate"><span class="pre">normalRegressionLayer.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-data-m"><code class="docutils literal notranslate"><span class="pre">monte_carlo_data.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nne-gen-m"><code class="docutils literal notranslate"><span class="pre">nne_gen.m</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nne-train-m"><code class="docutils literal notranslate"><span class="pre">nne_train.m</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

<footer class="bd-footer">
  <div class="bd-footer__inner bd-page-width">
    <div class="footer-items__start">    
        <div class="footer-item">
          <p>© Copyright 2023</p>
        </div>                        
    </div>                      
  </div>
</footer>

  </body>
</html>